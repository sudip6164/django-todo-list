{% extends 'todo/base.html' %}
{% block title %}Toâ€‘Do App{% endblock %}
{% block nav_home_active %}bg-white/10{% endblock %}
{% block content %}
        <!-- Header -->
        <h1 class="text-4xl font-bold mb-8 text-center text-gray-800 tracking-tight">My To-Do List</h1>
        <div class="rounded-lg border border-gray-100 p-4 bg-gradient-to-br from-white to-gray-50">
            <div class="flex items-center justify-between gap-4 flex-wrap">
                <form method="get" class="flex items-center gap-2">
                    <input type="text" name="q" value="{{ q }}" placeholder="Search tasks..." class="px-3 py-2 border rounded w-64" />
                    <label class="text-sm text-gray-600">Per page</label>
                    <select name="page_size" class="px-2 py-1 border rounded">
                        <option value="5" {% if page_size == 5 %}selected{% endif %}>5</option>
                        <option value="10" {% if page_size == 10 %}selected{% endif %}>10</option>
                        <option value="20" {% if page_size == 20 %}selected{% endif %}>20</option>
                    </select>
                    <input type="number" name="page_size" min="1" placeholder="Custom" class="w-24 px-2 py-1 border rounded" />
                    <button class="px-3 py-1.5 rounded-md border hover:bg-gray-50">Apply</button>
                </form>
                <p class="text-sm text-gray-600">Use Add Task to create new items.</p>
            </div>
        </div>

        <!-- Task List -->
        <ul class="mt-8 divide-y divide-gray-200" id="search-filter">
            {% for task in page_obj %}
            <li class="flex justify-between items-start py-4 transition-all duration-300 hover:bg-indigo-50/60 rounded-lg px-3 -mx-3">
                <!-- Checkbox & Task Info -->
                <form action="{% url 'toggle_complete' task.id %}" method="post" class="flex items-start gap-3 flex-1">
                    {% csrf_token %}
                    <input type="checkbox" onchange="this.form.submit()"
                           class="h-5 w-5 text-blue-600 rounded focus:ring-blue-500"
                           {% if task.completed %} checked{% endif %} />

                    <div>
                        <p class="text-lg font-medium {% if task.completed %}line-through text-gray-400{% else %}text-gray-800{% endif %}">
                            {{ task.title }}
                        </p>
                        {% if task.category %}
                        <p class="text-sm text-gray-500">Category: {{ task.category }}</p>
                        {% endif %}
                        {% if task.description %}
                        <p class="text-sm text-gray-600">{{ task.description }}</p>
                        {% endif %}
                        {% if task.due_date %}
                        <p class="text-xs text-gray-500 mt-1">ðŸ“… Due: {{ task.due_date|date:"M d, Y h:i A" }}</p>
                        {% endif %}
                        <!-- Priority Tag -->
                        <span class="inline-block mt-2 text-xs font-medium px-2 py-1 rounded-lg
                            {% if task.priority == 'H' %} bg-red-100 text-red-700 ring-1 ring-red-200
                            {% elif task.priority == 'L' %} bg-green-100 text-green-700 ring-1 ring-green-200
                            {% else %} bg-yellow-100 text-yellow-700 ring-1 ring-yellow-200 {% endif %}">
                            {{ task.get_priority_display }}
                        </span>
                    </div>
                </form>

                <!-- Delete Button -->
                <div class="flex items-center gap-2 ml-4">
                <a href="{% url 'edit_task' task.id %}"
                   class="text-blue-500 hover:text-blue-700 transition-colors duration-300">Edit</a>
                <a href="{% url 'delete_task' task.id %}"
                   class="ml-4 text-gray-400 hover:text-red-600 transition-colors duration-300">
                    <!-- Trash Icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none"
                         viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round"
                              d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6M9 7h6m2 0a2 2 0 012 2v0a2 2 0 01-2 2H7a2 2 0 01-2-2v0a2 2 0 012-2h10z" />
                    </svg>
                </a>
                </div>
            </li>
            {% empty %}
            <li class="text-center py-6 text-gray-500">No tasks yet. Use Add Task in the sidebar.</li>
            {% endfor %}
        </ul>
        <!-- Pagination -->
        {% if page_obj.paginator.num_pages > 1 %}
        <div class="flex items-center justify-center gap-2 mt-6">
            {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}&page_size={{ page_size }}&q={{ q }}" class="px-3 py-1.5 rounded-md border hover:bg-gray-50">Previous</a>
            {% endif %}
            <span class="text-sm text-gray-600">Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}</span>
            {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}&page_size={{ page_size }}&q={{ q }}" class="px-3 py-1.5 rounded-md border hover:bg-gray-50">Next</a>
            {% endif %}
        </div>
        {% endif %}
{% endblock %}
